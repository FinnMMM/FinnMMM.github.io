
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Externel Sorting | Myease „ÅÆ Page</title>
    <meta name="author" content="Myease" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/avatar.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>


<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.css" />
<script src="/js/lib/math.js"></script>


<script src="/js/lib/preview.js"></script>






<script src="https://s4.zstatic.net/ajax/libs/waline/2.15.8/waline.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/waline/2.15.8/waline.min.css" />
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/waline/2.15.8/waline-meta.min.css" />




<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>Âä†ËΩΩËøáÊÖ¢ËØ∑ÂºÄÂêØÁºìÂ≠ò ÊµèËßàÂô®ÈªòËÆ§ÂºÄÂêØ</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>MYEASE „ÅÆ PAGE</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;MYEASE „ÅÆ PAGE</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article-toc">
    
    <div id="toccard">
        <div id="toccard-style">
    <div id="card-div">
        <div class="description">
            <h2><span id="x2b50ÊñáÁ´†ÁõÆÂΩïx2b50"><span class="emoji" alias="star" style fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8">&#x2b50;</span>ÊñáÁ´†ÁõÆÂΩï<span class="emoji" alias="star" style fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8">&#x2b50;</span></span></h2>
<!-- toc -->
<ul>
<li><a href="#external-sorting">External Sorting</a>
<ul>
<li><a href="#2-way-merge-algorithm">2-way merge algorithm</a></li>
<li><a href="#reduce-number-of-passes">Reduce number of passes</a></li>
<li><a href="#reduce-the-number-of-tapes">Reduce the number of tapes</a></li>
<li><a href="#handle-the-buffers-for-parallel-operation">Handle the buffers for parallel operation</a></li>
<li><a href="#can-we-get-a-longer-run-each-time">Can we get a longer run each time?</a></li>
<li><a href="#how-to-minimize-merging-time">How to minimize merging time?</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<p><span class="emoji" alias="point_down" style fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f447.png?v8">
        </div>
    </div>
</div>


    </div>
    
    <div class="article">
        <div>
            <h1>Externel Sorting</h1>
        </div>
        <div class="info">
            <span class="date">
                <span class="icon">
                    <i class="fa-solid fa-calendar fa-fw"></i>
                </span>
                2024/12/27
            </span>
            
            
            <span class="tags">
                <span class="icon">
                    <i class="fa-solid fa-tags fa-fw"></i>
                </span>
                
                
                <span class="tag">
                    
                    <a href="/tags/ADS/" style="color: #00a596">
                        ADS
                    </a>
                </span>
                
            </span>
            
        </div>
        
        <div class="content" v-pre>
            <h2><span id="x2b50ÊñáÁ´†ÁõÆÂΩïx2b50"><span class="emoji" alias="star" style fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8">&#x2b50;</span>ÊñáÁ´†ÁõÆÂΩï<span class="emoji" alias="star" style fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8">&#x2b50;</span></span></h2>
<!-- toc -->
<ul>
<li><a href="#external-sorting">External Sorting</a>
<ul>
<li><a href="#2-way-merge-algorithm">2-way merge algorithm</a></li>
<li><a href="#reduce-number-of-passes">Reduce number of passes</a></li>
<li><a href="#reduce-the-number-of-tapes">Reduce the number of tapes</a></li>
<li><a href="#handle-the-buffers-for-parallel-operation">Handle the buffers for parallel operation</a></li>
<li><a href="#can-we-get-a-longer-run-each-time">Can we get a longer run each time?</a></li>
<li><a href="#how-to-minimize-merging-time">How to minimize merging time?</a></li>
</ul>
</li>
</ul>
<!-- tocstop -->
<p><span class="emoji" alias="point_down" style fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f447.png?v8">üëá</span></p>
<h2><span id="external-sorting">External Sorting</span></h2>
<h3><span id="introduction"> Introduction</span></h3>
<p>When data are too large to fit into internel memory, external sorting is a technique to sort them. It involves dividing the data into smaller chunks, sorting each chunk independently, and then merging the sorted chunks to obtain the final sorted result.</p>
<h3><span id="examples"> Examples</span></h3>
<h5><span id="defination">Defination</span></h5>
<ul>
<li>$B$ is the fixed-size of a block of data that can be read from the external storage.</li>
<li>$M$ is the number of blocks that the internal memory can solve once at a time.</li>
<li>$p$ is the number of passes needed to sort the data.</li>
<li>$b$ is the total I/O cost, which equals to the number of blocks.</li>
</ul>
<p>Now we have a internal memory with $M=3,B=1$.<br>
And the data with size $N=13$ is originally stored in a tape $T_1$ in the external storage.</p>
<h4><span id="2-way-merge-algorithm">2-way merge algorithm</span></h4>
<p><img src="/2024/12/27/ads-15/1.png" alt></p>
<ul>
<li>step 1: We first load in the first three blocks of $T_1$ into the internal memory and sort them.</li>
<li>step 2: Then we write the sorted data<strong> (a run)</strong> back to a new tape $T_2$.</li>
<li>step 3: We load the second three blocks of $T_1$ into the internal memory and sort them.</li>
<li>We write the sorted data back to a new tape $T_3$.</li>
<li>step 4: We repeat step 2 and 3 for the remaining blocks of $T_1$ and then regard $T_1$ as empty.</li>
<li>step 5: We merge and sort the first pair of run in $T_2$ and $T_3$ and write it back to the empty tape $T_1$.</li>
<li>step 6: We merge and sort the second pair of run in $T_2$ and $T_3$ and write it back to the a new tape $T_4$.</li>
<li>step 7: We repeat step 5 and 6 for the remaining pairs of runs in $T_2$ and $T_3$ and then regard $T_2$ and $T_3$ as empty.</li>
<li>step 8: We repeat step 5 , 6 and 7 until all the data are sorted and stored in a single tape $T$.<br>
The number of runs after step 4 is $r=\lceil\frac{N}{M}\rceil=5$.<br>
The number of operations that merge two tapes is $t=\lceil\log_2\lceil\frac{N}{M}\rceil\rceil=3$.<br>
The number of passes is $p=1+t=4$.<br>
The cost of I/O is $b=2\frac{N}{B}\times p=104$.</li>
</ul>
<p>What we concern are</p>
<ul>
<li>seek time (number of passes)</li>
<li>time to merge $N$ records from input buffers to the output buffer</li>
<li>time to internally sort $M$ records</li>
<li>time to read or write one block of records<br>
So our goal is to</li>
<li>minimize the number of passes</li>
<li>minimize the number of run merges</li>
<li>minimize the number of run generation</li>
<li>minimize the number of buffer handling for parallel operation</li>
</ul>
<h4><span id="reduce-number-of-passes">Reduce number of passes</span></h4>
<p>Use a $k$-way merge algorithm to merge the runs in parallel.</p>
<p>So the number of passes $p=1+\lceil\log_k\lceil\frac{N}{M}\rceil\rceil$.<br>
It do decrease the number of passes, but since this algorithm requires $2k$ tapes, it is not good enough.</p>
<h4><span id="reduce-the-number-of-tapes">Reduce the number of tapes</span></h4>
<p>Try to use 3 tapes to solve 2-way merge problem.<br>
<img src="/2024/12/27/ads-15/2.png" alt><br>
If we simply use the old way, we may stuck here.<br>
So, if we are given two tapes with number of runs $r_2=5$ and $r_3=3$,<br>
<img src="/2024/12/27/ads-15/3.png" alt><br>
rather than put the even pairs and odd pairs into two tapes respectively, we can put the first 3 pairs into an empty tape $T_1$ and do nothing to the remained 2 runs.<br>
<img src="/2024/12/27/ads-15/4.png" alt><br>
With this strategy, we can reduce the number of tapes from $2k$ to $k+1$.<br>
If we review the processure of 2-way merge in reverse order,we can find that the number of runs in the longest tape is:<br>
$$F_0=0,F_1=1,F_2=1,F_3=2,F_4=3\cdots F_N=F_{N-1}+F_{n-2}$$<br>
It is a Fibonacci sequence!!<br>
It also has a similar property in k-way merge algorithm,that is:<br>
$$F_{N}^k=\begin{cases}0,\quad 0\leq N\leq k-2\\1,\quad N=k-1\\\sum_{i=1}^{k}F_{N-i}^k,\quad N\geq k\end{cases}$$</p>
<h4><span id="handle-the-buffers-for-parallel-operation">Handle the buffers for parallel operation</span></h4>
<ul>
<li>Buffer: When we are doing parallel writing and reading, we need to store both input and output data in the buffer.</li>
</ul>
<p>When the $k$ rises, the number of input buffers will increase,the size of buffer will decrease,the size of block will decrease,which end up with increasing the seeking time.</p>
<p>In general, for a $k$-way merge we need $2k$ input buffers and $2$ output buffers for parallel operations.</p>
<p>Beyond a certain $k$ value, the I\O time would actually increase despite the decrease in the number of passes being made.  The optimal value for $k$ clearly depends on disk parameters and the amount of internal memory available for buffers.</p>
<h4><span id="can-we-get-a-longer-run-each-time">Can we get a longer run each time?</span></h4>
<p>Yes,apart from selecting $M$ elements and sort then, we can do as follows:</p>
<ul>
<li>step 1: Select first $M$ elements and sort them.</li>
<li>step 2: Write the lowest one to the tape.</li>
<li>step 3: Add the next element to the remained $M-1$ elements and sort them.</li>
<li>step 4: Write the lowest one of those who are not greater than the previous one to the tape.</li>
<li>step 5: Repeat until there is no element left or all the $M$ elements in the buffer are greater than the previous one.Then one tape is built.</li>
<li>step 6: Repeat step 1 to step 5 for the remaining elements to build more runs.</li>
</ul>
<p>It is proved that the average length of a run $L_{avg}=2M$.</p>
<h4><span id="how-to-minimize-merging-time">How to minimize merging time?</span></h4>
<p>We can use a Huffman Tree to minimize the number of merging times.</p>
<p>For example,we are given 4 runs with length $l_1=2,l_2=4,l_3=5,l_4=15$.The best sequence to merge them is in the following order:<br>
<img src="/2024/12/27/ads-15/5.png" alt></p>
<div style="font-size:16px"><span style="float:right"><a style=" color: grey">‰∏ã‰∏ÄÁØá : Êó†</a></span><a href="https://finnmmm.github.io/2024/12/27/ads-14" target="_self">‰∏ä‰∏ÄÁØá : Parallel Algorithms</a></div>
        </div>

        
        
        
        
        
        <div id="comment">
            <div id="waline-container"></div>
        </div>
        
        
        
    </div>

</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2024 - 2025 Myease „ÅÆ Page
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;Myease
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    


<script>
    Waline.init({
        el: "#waline-container",
        serverURL: "vercin.vercel.app",
        commentCount: true,
        pageview: false,
        emoji: "https://unpkg.com/@waline/emojis@1.2.0/weibo,https://unpkg.com/@waline/emojis@1.2.0/alus,https://unpkg.com/@waline/emojis@1.2.0/bilibili,https://unpkg.com/@waline/emojis@1.2.0/qq,https://unpkg.com/@waline/emojis@1.2.0/tieba,https://unpkg.com/@waline/emojis@1.2.0/tw-emoji".split(","),
        meta: "nick,mail,link".split(","),
        requiredMeta: "nick".split(","),
        lang: "",
        wordLimit: 0,
        pageSize: "10",
        login: "enable",
        
    });
</script>



    
    <canvas
            id="fireworks"
            style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 32767"
    ></canvas>
    <script src="https://s4.zstatic.net/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="/js/fireworks.min.js"></script>
</body>
</html>
